# ===============================================================
# SPW Configuration
# ===============================================================
# Este arquivo centraliza o comportamento do fluxo híbrido
# (spec-workflow + comandos SPW + execução com subagents).
#
# Como usar:
# 1) Copie este arquivo para o projeto real em:
#    .spec-workflow/spw-config.toml
# 2) Registre o hook de SessionStart para rodar o script de sync.
# 3) Sempre que iniciar uma sessão no Claude, o template de tasks
#    será ajustado automaticamente conforme esta configuração.
#
# Observação importante:
# - Este arquivo NÃO substitui requirements/design/tasks.
# - Ele apenas controla o comportamento operacional dos comandos e
#   do hook de sincronização de template.
# ===============================================================

[execution]
# tdd_default define o comportamento padrão de TDD no projeto.
#
# false:
# - TDD desligado por padrão (modelo "opt-in").
# - Só usa TDD quando a tarefa declarar explicitamente `TDD: required`
#   ou quando você mudar essa configuração para true.
#
# true:
# - TDD ligado por padrão.
# - Tarefas com `TDD: inherit` passam a exigir ciclo RED->GREEN.
#
# Recomendação inicial para o seu caso: false.
tdd_default = false

# Se true, o executor deve exigir evidência mínima de RED->GREEN
# em tarefas com TDD ativo (ex.: teste falhou antes e passou depois).
# Isso evita "testes escritos depois" sem garantir disciplina.
tdd_require_red_green_evidence = true

# Se true, o executor bloqueia avanço de batch/wave quando encontrar:
# - falta de rastreabilidade de requirements
# - ausência de verificação por tarefa
# - falhas de checkpoint crítico
strict_gates = true

[templates]
# Controla se o hook deve sincronizar tasks-template no SessionStart.
#
# true  -> hook ativo: escolhe variante e atualiza tasks-template.md
# false -> hook inativo: não altera template automaticamente
sync_tasks_template_on_session_start = true

# Define como escolher a variante do template de tasks.
#
# Valores suportados:
# - "auto": decide com base em [execution].tdd_default
# - "on":  força variante TDD ON
# - "off": força variante TDD OFF
#
# "auto" é o mais recomendado para manter uma fonte única de verdade
# no parâmetro execution.tdd_default.
tasks_template_mode = "auto"

# Caminho do diretório que contém as variantes de template.
# Esse caminho é relativo à raiz do projeto.
# Exemplo esperado:
# .spec-workflow/user-templates/variants/
variants_dir = ".spec-workflow/user-templates/variants"

# Caminho do template ativo que o spec-workflow vai usar.
# O hook escreve aqui após escolher a variante.
active_tasks_template_path = ".spec-workflow/user-templates/tasks-template.md"

# Nome do arquivo de variante quando TDD estiver ON.
tasks_template_tdd_on_file = "tasks-template.tdd-on.md"

# Nome do arquivo de variante quando TDD estiver OFF.
tasks_template_tdd_off_file = "tasks-template.tdd-off.md"

[safety]
# Se true, o hook gera backup do template ativo antes de sobrescrever.
# Formato: tasks-template.md.bak-YYYYMMDDHHMMSS
backup_before_overwrite = true

# Se true, o hook roda em modo simulação (não escreve arquivos).
# Útil para validar comportamento sem alterar nada.
dry_run = false

# Se true, o hook falha com exit code 1 quando faltar variante/config.
# Se false, ele apenas avisa e encerra sem quebrar a sessão.
fail_hard_on_missing_template = false
